# OpenLDAP

https://yannsolliard.notion.site/LDAP-caa6570292ba488ba734b5e7ec40ec0f

# OpenLDAP

## Docker Hub

[Docker Hub](https://hub.docker.com/r/bitnami/openldap/)

<aside>
‚ö†Ô∏è **Attention :** 

Pour utiliser ce docker-compose.yml il faut cr√©er une arborescence comme suit :

.
‚îú‚îÄ‚îÄ docker-compose.yml
‚îî‚îÄ‚îÄ ldap
        ‚îú‚îÄ‚îÄ bootstrap.ldif
        ‚îî‚îÄ‚îÄ Dockerfile

</aside>

## docker-compose.yml

```yaml
version: '3.3'
services:
  openldap:
    # image: osixia/openldap:latest
    container_name: openldap
    build: ./ldap
    hostname: openldap
    ports: 
      - "389:389"
      - "636:636"
    volumes:
      - /data/openldap/certificates:/container/service/slapd/assets/certs
      - /data/openldap/slapd/database:/var/lib/ldap
      - /data/openldap/slapd/config:/etc/ldap/slapd.d
    environment: 
      - LDAP_ORGANISATION=cpnv-srw3
      - LDAP_DOMAIN=cpnv-srw3.ch
      - LDAP_ADMIN_USERNAME=admin
      - LDAP_ADMIN_PASSWORD=admin_pass
      - LDAP_CONFIG_PASSWORD=conf_pass
      - "LDAP_BASE_DN=dc=cpnv-srw3,dc=ch"
      - LDAP_TLS_CRT_FILENAME=server.crt
      - LDAP_TLS_KEY_FILENAME=server.key
      - LDAP_TLS_CA_CRT_FILENAME=cpnv-srw3.ch.ca.crt
    networks:
      - srw3
  
  phpldapadmin:
    image: osixia/phpldapadmin:latest
    container_name: phpldapadmin
    hostname: phpldapadmin
    ports: 
      - "80:80"
    environment: 
      - PHPLDAPADMIN_LDAP_HOSTS=openldap
      - PHPLDAPADMIN_HTTPS=false
    depends_on:
      - openldap
    networks:
      - srw3

networks:
  srw3:
    driver: bridge
```

## bootstrap.ldif

```yaml
# LDIF Export for ou=People,dc=cpnv-srw3,dc=ch
# Server: openldap (openldap)
# Search Scope: sub
# Search Filter: (objectClass=*)
# Total Entries: 4
#
# Generated by phpLDAPadmin (http://phpldapadmin.sourceforge.net) on February 7, 2022 2:03 pm
# Version: 1.2.5

version: 1

# Entry 1: ou=People,dc=cpnv-srw3,dc=ch
dn: ou=People,dc=cpnv-srw3,dc=ch
objectclass: organizationalUnit
objectclass: top
ou: People

# Entry 2: cn=People,ou=People,dc=cpnv-srw3,dc=ch
dn: cn=People,ou=People,dc=cpnv-srw3,dc=ch
cn: People
gidnumber: 500
objectclass: posixGroup
objectclass: top

# Entry 3: cn=user01 user01,ou=People,dc=cpnv-srw3,dc=ch
dn: cn=user01 user01,ou=People,dc=cpnv-srw3,dc=ch
cn: user01 user01
gidnumber: 500
givenname: user01
homedirectory: /home/users/uuser01
loginshell: /bin/bash
objectclass: inetOrgPerson
objectclass: posixAccount
objectclass: top
sn: user01
uid: uuser01
uidnumber: 1000
userpassword: {MD5}XaDwHqhNrOAxzy6EUPHdjg==

# Entry 4: cn=user02 user02,ou=People,dc=cpnv-srw3,dc=ch
dn: cn=user02 user02,ou=People,dc=cpnv-srw3,dc=ch
cn: user02 user02
gidnumber: 500
givenname: user02
homedirectory: /home/users/uuser02
loginshell: /bin/bash
objectclass: inetOrgPerson
objectclass: posixAccount
objectclass: top
sn: user02
uid: uuser02
uidnumber: 1001
userpassword: {MD5}/6ook37tkKplasmA1Yj7qw==
```

## Dockerfile

```docker
FROM osixia/openldap:latest
COPY bootstrap.ldif /container/service/slapd/assets/config/bootstrap/ldif
```

## Sources

[docker-openldap/docker-compose.yml at master ¬∑ osixia/docker-openldap](https://github.com/osixia/docker-openldap/blob/master/example/docker-compose.yml)

[GitHub - osixia/docker-openldap: A docker image to run OpenLDAP üê≥](https://github.com/osixia/docker-openldap)